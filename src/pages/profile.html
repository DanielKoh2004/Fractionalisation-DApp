<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>User Profile â€” RealEstate dApp</title>
<style>
  body{font-family:Inter,Arial;margin:0;background:#f6fbff}
  header{background:#fff;padding:14px 24px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 6px rgba(0,0,0,0.05)}
  .logo{font-weight:bold;font-size:18px}
  .nav-link {
    transition: color 0.2s, box-shadow 0.2s;
    border-radius: 6px;
    padding: 4px 10px;
    text-decoration: none;
    color: #4636e3;
    font-weight: 500;
    font-size: 1.08rem;
  }
  .nav-link:hover {
    background: #edeaff;
    color: #0b63ff;
    box-shadow: 0 2px 8px rgba(70,54,227,0.10);
  }
  .btn-login {
    transition: color 0.2s, box-shadow 0.2s;
    background: #0b63ff;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 18px;
    font-size: 1.08rem;
    cursor: pointer;
    font-weight: 500;
    text-decoration: none;
    margin-left: 8px;
  }
  .btn-login:hover {
    background: #4636e3;
    color: #fff;
    box-shadow: 0 2px 8px rgba(70,54,227,0.10);
  }
  .profile-container {
    max-width:700px;margin:48px auto 0 auto;padding:32px;background:#fff;border-radius:18px;box-shadow:0 4px 24px rgba(70,54,227,0.08);
  }
  .profile-title {font-size:2.1rem;font-weight:700;color:#4636e3;margin-bottom:18px;}
  .profile-info {font-size:1.15rem;color:#444;line-height:1.6;margin-bottom:24px;}
  .profile-section {margin-bottom:32px;}
  .profile-label {font-weight:600;color:#4636e3;}
  .profile-value {color:#222;}
  .profile-avatar {width:80px;height:80px;border-radius:50%;background:#edeaff;display:flex;align-items:center;justify-content:center;font-size:2.2rem;font-weight:700;color:#4636e3;margin-bottom:18px;}
  .profile-table {width:100%;border-collapse:collapse;margin-top:24px;}
  .profile-table th, .profile-table td {padding:10px;border-bottom:1px solid #f0f4fb;text-align:left;}
  .profile-table th {background:#f6f5ff;color:#4636e3;font-weight:600;}
  .profile-table td {background:#fff;}
</style>
</head>
<body>
  <header>
    <div class="logo">RealEstate dApp</div>
    <div style="display:flex;align-items:center;gap:32px;">
      <nav style="display:flex;align-items:center;gap:24px;">
        <a href="index.html" class="nav-link">Home</a>
        <a href="marketplace.html" class="nav-link">Marketplace</a>
        <a href="dashboard.html" class="nav-link" id="profileBtn" style="display:none;">Profile</a>
        <a href="admin.html" class="nav-link" id="adminBtn" style="display:none;">Admin</a>
        <a href="about_us.html" class="nav-link">About Us</a>
        <a href="#" class="btn-login" id="loginBtn">Login</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none;">Logout</a>
      </nav>
    </div>
  </header>
  <main>
    <div class="profile-container">
      <div class="profile-title">User Profile</div>
      <div class="profile-avatar" id="profileAvatar">U</div>
      <div class="profile-section">
        <span class="profile-label">Name:</span> <span class="profile-value" id="profileName"></span><br>
        <span class="profile-label">Email:</span> <span class="profile-value" id="profileEmail"></span><br>
      </div>
      <div class="profile-section">
        <div class="profile-label" style="margin-bottom:8px;">Your Properties & Shares</div>
        <table class="profile-table" id="profileProperties">
          <thead>
            <tr><th>Property</th><th>Shares Owned</th><th>Share Value (ETH)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="profile-section">
        <div class="profile-label" style="margin-bottom:8px;">Transaction History</div>
        <table class="profile-table" id="profileTransactions">
          <thead>
            <tr><th>Date</th><th>Type</th><th>Property</th><th>Shares</th><th>Amount (ETH)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="profile-section">
        <div class="profile-label" style="margin-bottom:8px;">Dividend Distribution</div>
        <table class="profile-table" id="profileDividends">
          <thead>
            <tr><th>Property</th><th>Your Shares</th><th>Total Shares</th><th>Dividend Pool (USD)</th><th>Your Dividend (USD)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="dividendMsg" style="margin-top:12px;color:#4636e3;font-weight:500;"></div>
        <button id="claimDivBtn" style="margin-top:18px;padding:10px 24px;background:#4636e3;color:#fff;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Claim Dividends</button>
      </div>
      </div>
    </div>
  </main>
  <footer style="background:#fff;border-top:1px solid #e3e6fd;padding:24px 0;text-align:center;margin-top:48px;font-size:1.08rem;color:#444;">
    <div>&copy; 2025 RealEstate dApp. All rights reserved.</div>
  </footer>
<script>
function renderAuth() {
  const userStr = localStorage.getItem('currentUser');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const profileBtn = document.getElementById('profileBtn');
  const adminBtn = document.getElementById('adminBtn');
  if (userStr) {
    const user = JSON.parse(userStr);
    loginBtn.style.display = 'none';
    logoutBtn.style.display = '';
    if (user.isAdmin) {
      adminBtn.style.display = '';
      profileBtn.style.display = 'none';
    } else {
      adminBtn.style.display = 'none';
      profileBtn.style.display = '';
    }
  } else {
    loginBtn.style.display = '';
    logoutBtn.style.display = 'none';
    profileBtn.style.display = 'none';
    adminBtn.style.display = 'none';
  }
}
document.getElementById('loginBtn').addEventListener('click', function(e) {
  e.preventDefault();
  window.location.href = 'login.html';
});
document.getElementById('logoutBtn').addEventListener('click', function(e) {
  e.preventDefault();
  localStorage.removeItem('currentUser');
  renderAuth();
  window.location.reload();
});
window.addEventListener('DOMContentLoaded', function() {
  renderAuth();
  renderProfile();
  renderDividends();
  document.getElementById('claimDivBtn').onclick = claimDividends;
});
function renderProfile() {
  const userStr = localStorage.getItem('currentUser');
  if (!userStr) {
    alert('Please login to view your profile.');
    window.location.href = 'login.html';
    return;
  }
  const user = JSON.parse(userStr);
  document.getElementById('profileName').innerText = user.name || '-';
  document.getElementById('profileEmail').innerText = user.email || '-';
  document.getElementById('profileAvatar').innerText = user.name ? user.name[0].toUpperCase() : 'U';
  // Load ownership
  const ownership = JSON.parse(localStorage.getItem('ownership')||'[]');
  const properties = JSON.parse(localStorage.getItem('properties')||'[]');
  const userProps = ownership.filter(o=>o.userId===user.id && o.shares>0);
  const tbody = document.querySelector('#profileProperties tbody');
  if (userProps.length === 0) {
    tbody.innerHTML = '<tr><td colspan="3">No shares owned.</td></tr>';
  } else {
    tbody.innerHTML = userProps.map(o => {
      const prop = properties.find(p=>p.id===o.propertyId);
      return `<tr><td>${prop?prop.title:'-'}<\/td><td>${o.shares}<\/td><td>${prop?prop.sharePrice:'-'}<\/td><\/tr>`;
    }).join('');
  }

  // Transaction history
  const transactions = JSON.parse(localStorage.getItem('transactions')||'[]');
  const userTx = transactions.filter(t=>t.userId===user.id);
  const txBody = document.querySelector('#profileTransactions tbody');
  if (userTx.length === 0) {
    txBody.innerHTML = '<tr><td colspan="5">No transactions found.</td></tr>';
  } else {
    txBody.innerHTML = userTx.map(t => {
      const prop = properties.find(p=>p.id===t.propertyId);
      return `<tr><td>${new Date(t.timestamp).toLocaleString()}<\/td><td>${t.type}<\/td><td>${prop?prop.title:'-'}<\/td><td>${t.shares||'-'}<\/td><td>${t.amount||'-'}<\/td><\/tr>`;
    }).join('');
  }
}

// Simulate dividend pools (in a real app, this would come from backend/admin)
function getDividendPools() {
  // Example: [{propertyId: 1, amount: 1000}, ...]
  return JSON.parse(localStorage.getItem('dividendPools')||'[]');
}

function renderDividends() {
  const userStr = localStorage.getItem('currentUser');
  if (!userStr) return;
  const user = JSON.parse(userStr);
  const ownership = JSON.parse(localStorage.getItem('ownership')||'[]');
  const properties = JSON.parse(localStorage.getItem('properties')||'[]');
  const pools = getDividendPools();
  const userProps = ownership.filter(o=>o.userId===user.id && o.shares>0);
  const tbody = document.querySelector('#profileDividends tbody');
  if (!pools.length || userProps.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5">No dividends available.</td></tr>';
    return;
  }
  tbody.innerHTML = userProps.map(o => {
    const pool = pools.find(p=>p.propertyId===o.propertyId);
    const prop = properties.find(p=>p.id===o.propertyId);
    if (!pool || !prop) return '';
    // Calculate user's dividend
    const totalShares = prop.totalShares || prop.availableShares || 1;
    const userDividend = Math.round((pool.amount * (o.shares/totalShares))*100)/100;
    return `<tr><td>${prop.title}<\/td><td>${o.shares}<\/td><td>${totalShares}<\/td><td>$${pool.amount}<\/td><td>$${userDividend}<\/td><\/tr>`;
  }).join('');
}

function claimDividends() {
  // In a real app, this would trigger a payout transaction
  document.getElementById('dividendMsg').innerText = 'Dividends claimed! (Demo only)';
  setTimeout(()=>{
    document.getElementById('dividendMsg').innerText = '';
  }, 2500);
}
</script>
</body>
</html>
